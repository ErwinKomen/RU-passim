

<div class="row">&nbsp;</div>
<div id="manuscript_itemset" class="row">
  <div class="col-md-12">
    <!-- Sermons in this manuscript -->
    <h3>
      <span>Contents</span>
      {% if is_app_editor %}
        <span id="add_search_criteria" class="pull-right">
          <!-- Completely manual sermon adding -->
          <a class="btn btn-xs jumbo-3" role="button" 
              onclick="document.getElementById('create_new_sermon').submit();"
              >
            <span class="glyphicon glyphicon-plus"></span>Add a sermon to this manuscript
          </a>
        </span>
      {% endif %}
    </h3>

    <!-- Room to have the form-link to create a new sermon for this manuscript -->
    <div class="hidden" >
      <form id="create_new_sermon" action="{% url 'sermon_details' %}" method="post" >
        {% csrf_token %}
        <input type="text" name="sermo-manu" value="{{manuForm.instance.id}}" />
      </form>
    </div>

    <!-- Hidden hierarchy submit form -->
    <div class="hidden">
      <form id="save_new_hierarchy" method="post" action="{% url 'manuscript_hierarchy' pk=manuForm.instance.id %}">
        {% csrf_token %}
        <input type="text" id="id_manu-hlist" name="manu-hlist" value="" />
      </form>
    </div>

    {% if object.manusermons.count == 0 %}
      <p><i>This manuscript does not contain a definition of its contents</i></p>
    {% else %}

    <div id="sermonlog"></div>

      <!-- A place where the Sermons are put in hierarchically organized <div> elements -->
      <div id="sermon_tree" class="not_hidden">
        <div class="" level="1">
          <table class="func-view sermons" style="width: 100%;">
            <thead>
              <tr>
                <th class="draggable" style="width: 100%;">
                  <span>Details of this manuscript's {{object.manusermons.count}} items</span>
                  <span role="group" aria-label="erwin" class="btn-group btn-group-xs pull-right">
                    <span type="button" class="btn jumbo-1" title="Gryson/Clavis codes linked through the Super Sermon Gold"
                          onclick="ru.passim.seeker.manusermo(this, 'sig-auto');">Gryson A</span>
                    <span type="button" class="btn jumbo-2" title="Gryson/Clavis codes added manually"
                          onclick="ru.passim.seeker.manusermo(this, 'sig-manual');">Gryson M</span>
                    <span type="button" class="btn jumbo-2" title="Title of this sermon/item"
                          onclick="ru.passim.seeker.manusermo(this, 'title');">Title</span>
                    <span type="button" class="btn jumbo-2" title="Attributed author"
                          onclick="ru.passim.seeker.manusermo(this, 'author');">Author</span>
                    <span type="button" class="btn jumbo-2" title="Incipit"
                          onclick="ru.passim.seeker.manusermo(this, 'incipit');">Inc</span>
                    <span type="button" class="btn jumbo-2" title="Explicit"
                          onclick="ru.passim.seeker.manusermo(this, 'explicit');">Exc</span>
                    <span type="button" class="btn jumbo-1" title="Note"
                          onclick="ru.passim.seeker.manusermo(this, 'note');">Note</span>
                    <span type="button" class="btn jumbo-1" title="Kewords attached to the Super Sermon Gold"
                          onclick="ru.passim.seeker.manusermo(this, 'kw-auto');">Keywords A</span>
                    <span type="button" class="btn jumbo-1" title="Kewords manually attached to this sermon"
                          onclick="ru.passim.seeker.manusermo(this, 'kw-manual');">Keywords M</span>
                  </span>
                </th>
                <th class="tdnowrap">
                  {% if is_app_editor %}
                    <span>
                      <a mode="restore" class="edit-mode btn btn-xs jumbo-1 hidden" 
                         onclick="ru.passim.seeker.manuscript('restore');">
                        <span class="glyphicon glyphicon-arrow-left" title="Restore to the original sermon hierarchy"></span>
                      </a>
                    </span>
                    <span>
                      <a mode="save" class="edit-mode btn btn-xs jumbo-2 hidden" 
                         onclick="ru.passim.seeker.manuscript('save', this);"
                         targetid=""
                         targeturl="{% if manuForm.instance.id %}{% url 'manuscript_details' manuForm.instance.id %}{% endif %}" >
                        <span class="glyphicon glyphicon-ok" title="Save this sermon hierarchy"></span>
                        Save
                      </a>
                    </span>
                    <span class="hidden waiting">
                      <span>Processing changes...</span><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span>
                    </span>
                  {% endif %}
                  <span>
                    <a mode="expand" role="button" class="btn btn-xs jumbo-1" 
                         onclick="ru.passim.seeker.manuscript('expand');">
                        <span class="glyphicon glyphicon-collapse-down" title="Expand the whole hierarchy"></span>
                    </a>
                  </span>
                  <span>
                    <a mode="collapse" role="button" class="btn btn-xs jumbo-1" 
                         onclick="ru.passim.seeker.manuscript('collapse');">
                        <span class="glyphicon glyphicon-collapse-up" title="Collapse the whole hierarchy"></span>
                    </a>
                  </span>
                </th>
              </tr>
            </thead>
          </table>
        </div>
        <!-- This is where the sermon hierarchy is put-->
        <div id="sermon_tree_main">
          {% for sermon in sermon_list %}
            {% if sermon.childof == 1 %}
              {% include 'seeker/sermon_one.html' with sermon=sermon sermon_list=sermon_list level=1 %}
            {% endif %}
          {% endfor %}
        </div>
      </div>
      <!-- Copy of the tree -->
      <div id="sermon_tree_copy" class="hidden"></div>

    {% endif %}
  </div>
</div>

<script>
  ru.passim.seeker.manuscript('init');
</script>

