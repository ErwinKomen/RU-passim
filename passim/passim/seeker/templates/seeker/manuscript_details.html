{% extends "layout.html" %}
{% load i18n %}

{% block breadcrumbs %}
  <div class="breadcrumbs">
      <a href="{% url 'home' %}">Home</a>
      &rsaquo; <a href="{% url 'search_manuscript' %}">Search manuscripts</a>
      &rsaquo; Manuscript Details
  </div>
{% endblock %}

{% block content %}
  <div>

    {% if authenticated %}
      <div id="manuscript_top" class="panel panel-default">

        <!-- Manuscript information -->
        <h3>
          <span>Manuscript</span>
          <span class="pull-right" style="font-size: xx-small;">{{object.library.city.name}}, {{object.library.name}}, {{object.idno}}</span>
        </h3>
        <table style="width: 90%;" class="manuscript-details">
          <tbody>
            <!-- Row to indicate editing, if possible -->
            {% if is_passim_editor %}
            <tr><td colspan="2" class="ms editable"></td></tr>
            {% endif %}

            <tr>
              <td valign="top" style="width: 100px;"><b>Country</b></td>
              <td class="manuscript-country" align="left">
                <div class="view-mode">{% if manuForm.country %}{{manuForm.country.value}}{% endif %}</div>
                {% if is_passim_editor %}<div class="edit-mode hidden">{{manuForm.country}}</div>{% endif %}
              </td>
            </tr>
            <tr>
              <td valign="top"><b>City</b></td>
              <td class="manuscript-city" align="left">
                <div class="view-mode">{% if manuForm.city %}{{manuForm.city.value}}{% endif %}</div>
                {% if is_passim_editor %}<div class="edit-mode hidden">{{manuForm.city}}</div>{% endif %}
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Library</b></td>
              <td class="manuscript-library" align="left">
                <div class="view-mode">{{manuForm.instance.library.name}}</div>
                {% if is_passim_editor %}<div class="edit-mode hidden">{{manuForm.library}}</div>{% endif %}
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Identifier</b></td>
              <td class="manuscript-name" align="left">
                <div class="view-mode">{{manuForm.idno.value}}</div>
                {% if is_passim_editor %}<div class="edit-mode hidden">{{manuForm.idno}}</div>{% endif %}
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Title</b></td>
              <td class="manuscript-name" align="left">
                <div class="view-mode">{{manuForm.name.value}}</div>
                {% if is_passim_editor %}<div class="edit-mode hidden">{{manuForm.name}}</div>{% endif %}
              </td>
            </tr>

            <!-- Dates for this manuscript -->
            <tr>
              <td valign="top"><b>Date</b></td>
              <td class="manuscript-date" align="left">
                <div class="view-mode">{{manuForm.yearstart.value}} - {{manuForm.yearfinish.value}}</div>
                {% if is_passim_editor %}<div class="edit-mode hidden">{{manuForm.yearstart}} - {{manuForm.yearfinish}}</div>{% endif %}
              </td>
            </tr>

            <!-- Physical appearance -->
            <tr>
              <td valign="top"><b>Support</b></td>
              <td class="manuscript-support" align="left">
                <div class="view-mode">{% if object.support %}{{manuForm.support.value}}{% else %}-{% endif %}</div>
                {% if is_passim_editor %}<div class="edit-mode hidden">{{manuForm.support}}</div>{% endif %}
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Extent</b></td>
              <td class="manuscript-extent" align="left">
                <div class="view-mode">{% if object.extent %}{{manuForm.extent.value}}{% else %}-{% endif %}</div>
                {% if is_passim_editor %}<div class="edit-mode hidden">{{manuForm.extent}}</div>{% endif %}
              </td>
            </tr>
            <tr>
              <td valign="top"><b>Format</b></td>
              <td class="manuscript-format" align="left">
                <div class="view-mode">{% if object.format %}{{manuForm.format.value}}{% else %}-{% endif %}</div>
                {% if is_passim_editor %}<div class="edit-mode hidden">{{manuForm.format}}</div>{% endif %}
              </td>
            </tr>

            <!-- External link -->
            <tr>
              <td><b>External</b></td>
              <td class="manuscript-support" align="left">
                <div class="view-mode">
                {% if object.url %}
                  <a title="External link" href="{{object.url}}" target="_blank" >{{object.url}}</a>
                {% else %}
                  -
                {% endif %}
                </div>
                {% if is_passim_editor %}<div class="edit-mode hidden">{{manuForm.url}}</div>{% endif %}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="container">
        <!-- Sermons in this manuscript -->
        <h3>Contents</h3>
        {% if object.sermons.count == 0 %}
          <p><i>This manuscript does not contain a definition of its contents</i></p>
        {% else %}
          <table class="func-view">
            <thead><tr><th>#</th><th>Location</th><th>Details</th></tr></thead>
            <tbody>
              {% for msitem in object.sermons.all %}
                <!-- Show the details of this item -->
                <tr>
                  <td>{{forloop.counter}}</td>
                  <td class="tdnowrap">{% if msitem.sermon.locus %}{{msitem.sermon.locus}}{% else %}?{% endif %}</td>
                  <td style="width: 100%;">
                    {% if msitem.sermon.title %}<b>{{msitem.sermon.title}}</b>{% endif %}
                    {% if msitem.sermon.author %}
                      (by <span class="sermon-author">{{msitem.sermon.author}}</span>)
                    {% elif msitem.sermon.nickname %}
                      (by <span class="sermon-nickname">{{msitem.sermon.nickname}}</span>)
                    {% endif %}
                    {% if msitem.sermon.incipit %}<i>{{msitem.sermon.incipit}}</i>{% endif %}
                    {% if msitem.sermon.incipit or msitem.sermon.explicit %}...-...{% endif %}
                    {% if msitem.sermon.explicit %}<i>{{msitem.sermon.explicit}}</i>{% endif %}
                    {% if msitem.sermon.note %}(Note: {{msitem.sermon.note}}){% endif %}
                  </td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
      </div>
    {% else %}
      <div class="explanation">
        <p>Dear user, you are <b>not</b> logged in.</p>
        <p>Unfortunately this means that you will not be able to perform any searches.</p>
        <p>Should you want to work with Passim, here are your options:
          <ul>
            <li><a class="btn btn-info btn-xs" href="{% url 'login' %}">Login</a> - if you already have an account</li> 
            <li><a class="btn btn-warning btn-xs" href="{% url 'signup' %}">Sign up</a> - if you don't have an account yet</li>
          </ul>
        </p>
      </div>
    {% endif %}
    
  </div>

<script>
  ru.passim.init_event_listeners();
  ru.passim.seeker.init_events();
</script>


{% endblock content %}
