{% extends "layout.html" %}
{% load i18n %}

{% block breadcrumbs %}
  <div class="breadcrumbs">
      <a href="{% url 'home' %}">Home</a>
      &rsaquo; <a href="{% url 'search_manuscript' %}">Search manuscripts</a>
      &rsaquo; Manuscript Details
  </div>
{% endblock %}

{% block content %}
  <div>

    {% if authenticated %}
 
      <!-- Incorporate the manuscript details-->
      <div id="manuscript_info" class="panel panel-default">
        {% include 'seeker/manuscript_info.html' %}
      </div>

      <div class="container">
        <!-- Sermons in this manuscript -->
        <h3>
          <span>Contents</span>
          <span id="add_search_criteria" class="pull-right">
            <a class="btn btn-xs jumbo-3" role="button"><span class="glyphicon glyphicon-plus"></span>Add a sermon to this manuscript</a>
          </span>
        </h3>
        {% if object.sermons.count == 0 %}
          <p><i>This manuscript does not contain a definition of its contents</i></p>
        {% else %}
          <div id="sermon_edit"></div>

          <table class="func-view">
            <thead><tr><th>#</th><th>Location</th><th>Details</th></tr></thead>
            <tbody>
              <!-- Use the formset to show the sermons related to this manuscript -->
              {% for msitem in object.sermons.all %}
                <!-- Show the details of this item -->
                <tr class="form-row">
                  <td class="hoverable">{{forloop.counter}}</td>
                  <td class="tdnowrap hoverable">{% if msitem.locus %}{{msitem.locus}}{% else %}?{% endif %}</td>
                  <td style="width: 100%;" targeturl="{{msitem.target}}">
                    <!-- View mode is visible by default-->
                    <div class="view-mode clickable" onclick="ru.passim.seeker.sermo_edit(this);">
                      {% if msitem.title %}<b>{{msitem.title}}</b>{% endif %}
                      {% if msitem.author %}
                        (by <span class="sermon-author">{{msitem.author.name}}</span>)
                      {% elif msitem.nickname %}
                        (by <span class="sermon-nickname">{{msitem.nickname.name}}</span>)
                      {% endif %}
                      {% if msitem.incipit %}<i>{{msitem.incipit}}</i>{% endif %}
                      {% if msitem.incipit or msitem.explicit %}...-...{% endif %}
                      {% if msitem.explicit %}<i>{{msitem.explicit}}</i>{% endif %}
                      {% if msitem.note %}(Note: {{msitem.note}}){% endif %}
                    </div>

                    {% if is_passim_editor %}
                    <!-- Edit mode is only visible for passim editors -->
                    <div class="edit-mode hidden" >
                    </div>

                    {% endif %}
                  </td>
                </tr>
              {% endfor %}

            </tbody>
          </table>

        {% endif %}
      </div>
    {% else %}
      <div class="explanation">
        <p>Dear user, you are <b>not</b> logged in.</p>
        <p>Unfortunately this means that you will not be able to perform any searches.</p>
        <p>Should you want to work with Passim, here are your options:
          <ul>
            <li><a class="btn btn-info btn-xs" href="{% url 'login' %}">Login</a> - if you already have an account</li> 
            <li><a class="btn btn-warning btn-xs" href="{% url 'signup' %}">Sign up</a> - if you don't have an account yet</li>
          </ul>
        </p>
      </div>
    {% endif %}
    
  </div>

<script>
  ru.passim.init_event_listeners();
  ru.passim.seeker.init_events();
</script>


{% endblock content %}
